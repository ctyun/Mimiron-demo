<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>components\tree\treeview.js - Mimiron</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Mimiron" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AbstractECharts.html">AbstractECharts</a></li>
                                <li><a href="../classes/Ajax.html">Ajax</a></li>
                                <li><a href="../classes/Autocomplete.html">Autocomplete</a></li>
                                <li><a href="../classes/AutoSelect.html">AutoSelect</a></li>
                                <li><a href="../classes/BasicArea.html">BasicArea</a></li>
                                <li><a href="../classes/BasicColumn.html">BasicColumn</a></li>
                                <li><a href="../classes/BasicLine.html">BasicLine</a></li>
                                <li><a href="../classes/BasicPie.html">BasicPie</a></li>
                                <li><a href="../classes/BSSForm.html">BSSForm</a></li>
                                <li><a href="../classes/BSSFrame.html">BSSFrame</a></li>
                                <li><a href="../classes/BSSPanel.html">BSSPanel</a></li>
                                <li><a href="../classes/Button.html">Button</a></li>
                                <li><a href="../classes/CascadeSelect.html">CascadeSelect</a></li>
                                <li><a href="../classes/Checkbox.html">Checkbox</a></li>
                                <li><a href="../classes/CheckboxGroup.html">CheckboxGroup</a></li>
                                <li><a href="../classes/DatePicker.html">DatePicker</a></li>
                                <li><a href="../classes/ECharts.html">ECharts</a></li>
                                <li><a href="../classes/ExpressionSelect.html">ExpressionSelect</a></li>
                                <li><a href="../classes/Grid.html">Grid</a></li>
                                <li><a href="../classes/Header.html">Header</a></li>
                                <li><a href="../classes/Input.html">Input</a></li>
                                <li><a href="../classes/IrregularLine.html">IrregularLine</a></li>
                                <li><a href="../classes/message.html">message</a></li>
                                <li><a href="../classes/MessageBox.html">MessageBox</a></li>
                                <li><a href="../classes/Modal.html">Modal</a></li>
                                <li><a href="../classes/PageButton.html">PageButton</a></li>
                                <li><a href="../classes/PageItem.html">PageItem</a></li>
                                <li><a href="../classes/Pager.html">Pager</a></li>
                                <li><a href="../classes/PageSizeSelect.html">PageSizeSelect</a></li>
                                <li><a href="../classes/QueryPanel.html">QueryPanel</a></li>
                                <li><a href="../classes/Select.html">Select</a></li>
                                <li><a href="../classes/SideBar.html">SideBar</a></li>
                                <li><a href="../classes/StackedArea.html">StackedArea</a></li>
                                <li><a href="../classes/StackedColumn.html">StackedColumn</a></li>
                                <li><a href="../classes/StackedLine.html">StackedLine</a></li>
                                <li><a href="../classes/Tab.html">Tab</a></li>
                                <li><a href="../classes/TablePanel.html">TablePanel</a></li>
                                <li><a href="../classes/Tabs.html">Tabs</a></li>
                                <li><a href="../classes/TencentMap.html">TencentMap</a></li>
                                <li><a href="../classes/Textarea.html">Textarea</a></li>
                                <li><a href="../classes/ToolBarPanel.html">ToolBarPanel</a></li>
                                <li><a href="../classes/TopBar.html">TopBar</a></li>
                                <li><a href="../classes/Treeview.html">Treeview</a></li>
                                <li><a href="../classes/TreeWithTable.html">TreeWithTable</a></li>
                                <li><a href="../classes/window.html">window</a></li>
                                <li><a href="../classes/WordCloud.html">WordCloud</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/BSSFrame.html">BSSFrame</a></li>
                                <li><a href="../modules/ECharts.html">ECharts</a></li>
                                <li><a href="../modules/html.html">html</a></li>
                                <li><a href="../modules/message.html">message</a></li>
                                <li><a href="../modules/page.html">page</a></li>
                                <li><a href="../modules/panel.html">panel</a></li>
                                <li><a href="../modules/tabs.html">tabs</a></li>
                                <li><a href="../modules/TencentMap.html">TencentMap</a></li>
                                <li><a href="../modules/tree.html">tree</a></li>
                                <li><a href="../modules/utils.html">utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: components\tree\treeview.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module tree
 */

var React=require(&quot;react/addons&quot;);
var treeCommonMixin = require(&quot;./treecommon&quot;);
var Debug = require(&quot;../utils/debug&quot;);

/**
 * 树形组件
 *&#x60;&#x60;&#x60;
   使用说明
   data: (object)树中展现的数据, 格式请参考demo.js, 每个节点可以有如下属性:
    -&quot;name&quot;:显示的名称.
    -&quot;uid&quot;:唯一的Id,注意,此ID必须唯一, 如果留空,则自动生成一个.
    -&quot;selectType&quot;:该节点的选择类型,可以为&quot;checkbox&quot;(节点可以多选,默认值),&quot;radio&quot;(在该级下单选),&quot;none&quot;(不显示选择框)
    -&quot;isSelected&quot;:(string)该节点默认被选中,默认值为&quot;none&quot;,可选:&quot;all&quot;,&quot;part&quot;,&quot;none&quot;
    -&quot;isExpanded&quot;:(boolean)该节点默认被展开,默认值为flase.
   selectType: (string)
    -&quot;none&quot;:树的每个节点前没有可操作的元素
    -&quot;checkbox&quot;:树的每个节点前有一个勾选框
    -&quot;radio&quot;:树的每个节点成为单选项
   onElementCheck: (function)节点被勾选(取消勾选)时的回调函数.
    -return parms:
        -uid:目标节点的uid值,如果输入的data中没有标记uid,会返回一个唯一的随机字符串.
        -status:目标节点操作状态, &#x27;check&#x27;为勾选操作, &#x27;unckeck&#x27;为取消勾选.
        -name: 目标节点显示的内容
   onElementFlod: (function)节点被展开(收起)时的回调函数.
    -return params:
        -uid:目标节点的uid值,如果输入的data中没有标记uid,会返回一个唯一的随机字符串.
        -status:目标节点操作状态, &#x27;flod&#x27;为收起操作, &#x27;unckeck&#x27;为展开操作.
   expandLevel: (int)展开级别
   maxHeight:(string) 比如:&quot;300px&quot;

    var tree1Data = {
        treedata: [
            {
                &quot;name&quot;: &quot;Top Level&quot;,
                &quot;uid&quot;: &quot;uid1&quot;,
                &quot;children&quot;: [
                    {
                        &quot;name&quot;: &quot;Level 2: A&quot;,
                        &quot;uid&quot;: &quot;uid2&quot;,
                        &quot;children&quot;: [
                            {
                                &quot;name&quot;: &quot;Son of A&quot;
                            },
                            {
                                &quot;name&quot;: &quot;Daughter of A&quot;
                            }
                        ]
                    },
                    {
                        &quot;name&quot;: &quot;Level 2: B&quot;
                    },
                    {
                        &quot;name&quot;: &quot;Level 2: C&quot;,
                        &quot;children&quot;: [
                            {
                                &quot;name&quot;: &quot;Son of C&quot;
                            }
                        ]
                    }
                ]
            }
        ]
    }
    &lt;Treeview data={tree1Data} selectType=&quot;checkbox&quot;/&gt;
 *&#x60;&#x60;&#x60;
 * @class Treeview
 * 
 */
var Treeview = React.createClass({
    name: &#x27;treeview&#x27;,
    mixins: [treeCommonMixin],
    statics:{
        /*
         * 用于保存树的json对象数组，传入的值为[json对象]
         *
         * @static
         * @property treedata
         * @type Array
         * @default []
         * 
         */
        treedata:[],

        /*
         * targetTreedata 目标树，注意, static方法不能给static方法提供返回值
         * @static
         * @property targetTreedata
         * @type Array
         * @default null
         */
        targetTreedata:null, 

        /*
         * 返回所有已选中的值
         * @static
         * @method getAllCheckedNodes
         * @param {String} uid 树的根节点
         * @return {Array} 返回所有的已选择的值
         */
        getAllCheckedNodes: function(uid){
            Treeview.treedata = Treeview.treedata;
            var checked = [];
            if(uid){
                Treeview.findTreedata(uid,Treeview.treedata);
                Treeview.pushNodes(Treeview.targetTreedata,checked);
                return checked;
            }
            Treeview.pushNodes(Treeview.treedata,checked);
            return checked;
        },

        /*
         * 建立树结构
         * @static
         * @method pushNodes
         * @param {String} treedata 树的json值
         * @param {String} checked 已选择的节点
         * @return {Array} 返回所有的已选择的值
         */
        pushNodes: function(treedata,checked){
            for(var i in treedata){
                if(treedata[i].hasOwnProperty(&quot;children&quot;)&amp;&amp;treedata[i].children){
                    Treeview.pushNodes(treedata[i].children,checked);
                }
                if(treedata[i].isSelected!=&quot;none&quot;&amp;&amp;treedata[i].selectType!=&quot;none&quot;){
                    checked.push(treedata[i].uid);
                }
            }
        },

        /*
         * 在树中查找指定节点
         * @static
         * @method findTreedata
         * @param {String} uid 要查找节点uid
         * @param {String} treedata 要查找的树
         * @return {Array} 返回所有的已选择的值
         */
        findTreedata: function(uid,treedata){
            for(var i in treedata){
                if(treedata[i].hasOwnProperty(&quot;children&quot;)&amp;&amp;treedata[i].children){
                    Treeview.findTreedata(uid,treedata[i].children);
                }
                if(treedata[i].uid==uid){
                    Treeview.targetTreedata = treedata[i].children;
                }
            }
        }
    },
    
    /*
     * 定义属性
     * @private
     * @method getAttributes
     * @return {Array} 返回所有的初始定义的属性
     */
    getAttributes: function() {
        var attributes = [
            { name:&#x27;boxClass&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;container CSS class&#x27; },
            { name:&#x27;selectType&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&quot;none&quot;, note:&#x27;select type:none/checkbox/radio&#x27; },
            { name:&#x27;expandLevel&#x27;, type:&#x27;number&#x27;, required:false, defaultValue:1, note:&#x27;levels to expand&#x27; },
            { name:&#x27;treedata&#x27;, type:&#x27;array&#x27;, required:false, defaultValue:[], note:&#x27;input treeview data&#x27; },
            // internal, don&#x27;t pass in
            { name:&#x27;treedataObject&#x27;, type:&#x27;object&#x27;, required:false, defaultValue:[], note:&#x27;treeview data object&#x27; },
            { name:&#x27;treedataCol&#x27;, type:&#x27;array&#x27;, required:false, defaultValue:[], note:&#x27;treeview data in hash array&#x27; },
            { name:&#x27;maxHeight&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&quot;none&quot;, note:&quot;max height&quot;}
        ];
        return attributes;
    },

    /*
     * 定义外部属性默认值
     * @private
     * @method getDefaultProps
     * @return {Object} 返回所有的可通过外部传入属性的默认值
     */
    getDefaultProps: function(){
        return{
            onElementCheck: function(){return},
            onElementFlod: function(){return},
        }
    },

    /*
     * 组件要加载前执行
     * @private
     * @method componentWillMount
     */
    componentWillMount: function() {
        this.state.treedataObject = this.prepareTreedata(this.state.treedata);
        this.state.nodes = this.getNodesFromTreeItem(this.state.treedataObject); //用于操作的节点
    },

    /*
     * 组件接收到参数时执行
     * @private
     * @method componentWillReceiveProps
     */
    componentWillReceiveProps : function(nextProps){
        if (!nextProps.data){
            return ;
        }
        var state = this.state;
        var propsData = nextProps.data || {};
        var attributes = this.getAttributes();
        // loop through attributes defined for component
        for (var i = 0; i &lt; attributes.length; i++) {
            var attribute = attributes[i];
            var name = attribute.name;
            var attributeValue = this.props[name] || propsData[name];
            state[name] = attributeValue || attribute.defaultValue;
        }
        state.containerClassNames = [this.name + &#x27;-container&#x27;];
        state.boxClass &amp;&amp; state.containerClassNames.push(state.boxClass);
        // run additional setup if present
        //this.setupInitial &amp;&amp; this.setupInitial();
        state.treedataObject = this.prepareTreedata(nextProps.data.treedata); //用传入的数据
        //这里需要读取state.nodes.isExpanded/isSelected赋给state.treedataObject.children.isExpanded/isSelected
        this.copyProps(state.nodes,state.treedataObject.children);
        this.state.nodes = this.getNodesFromTreeItem(state.treedataObject);
        this.forceUpdate(); //需要强制刷新,防止缓存?
    },

    /*
     * 组件完成加载后执行
     * @private
     * @method componentDidMount
     */
    componentDidMount : function(){
        this.state.treedata.forEach(function(ins){
            Treeview.treedata.push(ins); //把所有根节点压栈,所有根节点uid必须不同.
        });
    },

    /*
     * 将nodes节点的属性复制到children节点上,递归执行
     * @private
     * @method copyProps
     * @param {String} nodes 要复制的源节点
     * @param {String} children 要复制的目标节点
     */
    copyProps: function(nodes,children){
        for(var i=0; i&lt;children.length; i++){
            for(var j=0; j&lt;nodes.length; j++){
                if(children[i].uid==nodes[j].uid){
                    children[i].isExpanded = nodes[j].isExpanded;
                    children[i].isSelected = nodes[j].isSelected;
                }
                if(children[i].hasOwnProperty(&quot;children&quot;)){
                    this.copyProps(nodes,children[i].children);
                }
            }
        }
    },
    

    /*
     * 为treedata添加唯一的id
     * @private
     * @method prepareTreedata
     * @param {Object} treedata 要添加的树
     * @return {Object} 返回已修改好的树 
     */
    prepareTreedata: function(treedata) {
        // convert object into array
        var startLevel = 1;
        this.state.treedataCol = {};
        if (typeof treedata === &#x27;object&#x27;) {
            if (treedata.constructor.name === &#x27;Array&#x27;) { //如果treedata为列表时 调用
                startLevel = 0;
                treedata = { children:treedata };
            }
        }
        this.processTreedataItem(treedata, startLevel);
        return treedata;
    },
    
    /*
     * 处理子树节点
     * @private
     * @method processTreedataItem
     * @param {Object} treedata 要修改的子树
     * @param {Integer} level 要处理的子树层级
     * @return {Object} 返回已修改好的树 
     */
    processTreedataItem: function(item, level) {
        item.level = level;
        item.uid = item.uid || this.generateUid();
        item.selectType = item.selectType || this.state.selectType;
        if(item.isSelected){ //可以通过{data}传入isSelected参数控制isSelected
            item.isSelected=item.isSelected;
        }
        else{
            item.isSelected = &quot;none&quot;; // select status can be all | partial | none
        } 
        item.isExpanded = item.isExpanded||(level &lt; this.state.expandLevel) || false; //可以通过{data}传入该参数
        item.hasChildren = (item.children &amp;&amp; item.children.length &gt; 0) || false;
        if (level &gt; 0) {
            this.state.treedataCol[item.uid] = item;
        }
        if (item.children) {
            for (var i = 0; i &lt; item.children.length; i++) {
                var childItem = item.children[i];
                this.processTreedataItem(childItem, level + 1);
            }
        }
    },
    
    /*
     * 处理子树节点
     * @private
     * @method getNodesFromTreeItem
     * @param {Object} item 要获取的子树
     * @return {Object} 返回指定节点的子树 
     */
    getNodesFromTreeItem: function(item) {
        var nodes = [];
        var currentNode = { isExpanded:true };
        var display = item.name || item.text || &#x27;NA&#x27;;
        // skip level 0, it is artificial object for array input
        if (item.level &gt; 0) {
            currentNode = {
                uid: item.uid,
                selectType : item.selectType,
                display: display,
                level: item.level,
                hasChildren: item.hasChildren,
                isExpanded: item.isExpanded,
                isSelected: item.isSelected,
                boxClass: item.boxClass,
            };
            nodes.push(currentNode);
        }
        if (item.children &amp;&amp; currentNode.isExpanded) {
            var childNodes = [];
            for (var i = 0; i &lt; item.children.length; i++) {
                var childItem = item.children[i];
                var childNodes = this.getNodesFromTreeItem(childItem);
                nodes = nodes.concat(childNodes);
            }
        }
        return nodes;
    },

    /*
     * update select status under item
     * @private
     * @method updateTreeSelectStatus
     * @param {Object} item item under update
     * @param {Object} changedItem the item that has change of status originally
     * @param {String} inheritStatus  optional, status to be updated to (inherited from parent)
     */
    updateTreeSelectStatus: function(item, changedItem, keepSelectStatus, inheritStatus) {
        if (keepSelectStatus)
            return;
        // set initial select status to tree item
        var deduceSelectStatus = false;
        if (item.uid === changedItem.uid) {
            // reached item that changes select status originally, no change is needed for item
            // set inheritStatus for children to set select status to
            inheritStatus = item.isSelected; // should be &quot;all&quot; or &quot;none&quot;
        } else if (inheritStatus) {
            // Set select status to inheritStatus if available
            item.isSelected = inheritStatus;
        } else {
            // need to deduce isSelected from children&#x27;s select statuses
            if (item.children &amp;&amp; item.children.length &gt; 0) {
                deduceSelectStatus = true;
            } else {
                // item remains current select status
            }
        }
        // process child items, keep track of selected child items
        var selectChildrenCount = 0;
        if (item.children &amp;&amp; item.children.length &gt; 0) {
            for (var i = 0; i &lt; item.children.length; i++) {
                var childItem = item.children[i];
                this.updateTreeSelectStatus(childItem, changedItem, keepSelectStatus, inheritStatus);
                if (childItem.isSelected === &quot;all&quot;) {
                    selectChildrenCount = selectChildrenCount + 1;
                } else if (childItem.isSelected === &quot;part&quot;) {
                    selectChildrenCount = selectChildrenCount + .5;
                }
            }
        }
        // to deduced select status, compare children count to selected children count
        if (deduceSelectStatus) {
            if (item.children &amp;&amp; item.children.length &gt; 0) {
                if (selectChildrenCount === item.children.length) {
                    item.isSelected = &quot;all&quot;;
                } else if (selectChildrenCount === 0) {
                    item.isSelected = &quot;none&quot;;
                } else {
                    item.isSelected = &quot;part&quot;;
                }
            } else {
                item.isSelected = &quot;none&quot;;
            }
        }
    },

    /*
     * 处理节点点击事件
     * @private
     * @method onNodeClick
     * @param {event} event 点击事件
     */
    onNodeClick: function(event) {
        var target = $(event.target);
        var cellId = target.attr(&#x27;data-uid&#x27;); 
        if (!cellId) { //如果点击文字, 效果和点击checkbox相同
            if (target.hasClass(&quot;treeview-textbox-content&quot;)){
                var reactId = target.attr(&quot;data-reactid&quot;);
                cellId = reactId.split(&quot;-&quot;)[1]+&quot;-select&quot;;
            }
        }
        //move from here
        // get cellId from cell icon &lt;i&gt; or from cell container
        if (target.hasClass(&#x27;treeview-cell-expand-container&#x27;)) {
            cellId = target.find(&#x27;i&#x27;).attr(&#x27;data-uid&#x27;);
        }
        
        // cellId format: &quot;&lt;nodeKey&gt;-&lt;cellType&gt;-&lt;select status&gt;-&lt;expand status&gt;&quot;
        // cellId example: &quot;36c2b148338c8d7a7f99ef6b881e281f-expand-a-e&quot;
        var parts = cellId.split(&#x27;-&#x27;);
        var nodeKey = parts[0];
        var cellType = parts[1];
        var treedataItem = this.state.treedataCol[nodeKey];
        var keepSelectStatus=true;
        // change this.state.treedata according to type of icon clicked
        switch (cellType) {
            case &#x27;expand&#x27;:
                treedataItem.isExpanded = !treedataItem.isExpanded;
                break;
            case &#x27;icon&#x27;:
                break;
            case &#x27;select&#x27;:
                keepSelectStatus=false;
                //clear all node.isSelected if selectTypr==&quot;radio&quot; (radio)
                if(this.state.selectType==&quot;radio&quot;){
                    var nodes = this.state.treedataCol;
                    for (var i in nodes){
                        nodes[i].isSelected=&quot;none&quot;;   
                    }
                    this.state.treedataCol = nodes;
                }
                else if(this.state.selectType==&quot;none&quot;){
                    break;
                }
                switch(treedataItem.isSelected) {
                case &quot;all&quot;:
                    treedataItem.isSelected = &quot;none&quot;;
                    break;
                case &quot;part&quot;:
                    treedataItem.isSelected = &quot;all&quot;;
                    break;
                case &quot;none&quot;:
                    treedataItem.isSelected = &quot;all&quot;;
                    break;
                }
                break;
        }
        // sync select status of all tree nodes
        this.updateTreeSelectStatus(this.state.treedataObject, treedataItem, keepSelectStatus); //这里出了问题
        this.state.nodes = this.getNodesFromTreeItem(this.state.treedataObject);
        //执行回调函数
        if (cellId.split(&#x27;-&#x27;)[1]==&quot;select&quot;){
            var uid = cellId.split(&#x27;-&#x27;)[0];
            var reactId = target.attr(&#x27;data-reactid&#x27;);
            var rawStatus = reactId.split(&#x27;-&#x27;)[2];
            var status=&quot;error&quot;;
            switch(rawStatus){
                case &quot;all&quot;:
                    status = &quot;uncheck&quot;;
                    break;
                case &quot;part&quot;:
                    status = &quot;check&quot;;
                    break;
                case &quot;none&quot;:
                    status = &quot;check&quot;;
            }
            var name=null; //将node的name一并返回
            var selectType = null;
            for(var i in this.state.nodes){
                if(this.state.nodes[i].uid==uid){
                    name=this.state.nodes[i].display;
                    selectType = this.state.nodes[i].selectType;
                }
            }
            if(selectType==&quot;none&quot;){ //如果节点不可操作, 不执行回调
                return;
            }
            //根据uid 和 status进行回调
            this.props.onElementCheck(uid,status,name);
        } 
        if (target.parent().hasClass(&#x27;treeview-cell-expand-container&#x27;)){ //added
            var reactId = target.parent().attr(&#x27;data-reactid&#x27;);
            var uid = reactId.split(&#x27;-&#x27;)[1];
            var status = reactId.split(&#x27;-&#x27;)[3]==&#x27;none.$treeview&#x27;?&#x27;unfold&#x27;:&#x27;fold&#x27;;
            //根据uid 和 status进行回调
            this.props.onElementFlod(uid,status);
        }
        // update display
        this.forceUpdate();
        Treeview.treedata = this.state.treedata;
    },

    /*
     * React render
     * @private
     * @method render
     * @return {Object} 返回组件
     */
    render: function() {
        var treenodes = [];
        for (var i = 0; i &lt; this.state.nodes.length; i++) {
            var node = this.state.nodes[i];
            node.selectType = node.selectType || this.state.selectType;
            // need to include node properties tied with UI change, for example: isExpanded
            var nodeKey = &#x27;treenode-&#x27; + node.uid;
            nodeKey += &#x27;-&#x27; + node.isSelected;
            nodeKey += &#x27;-&#x27; + (node.isExpanded ? &#x27;e&#x27; : &quot;none&quot;);
            treenodes.push(&lt;TreeviewNode data={ node } key={ nodeKey } /&gt;);
        }
        var flagCssClass = true;
        for (var i in this.state.containerClassNames){
            if(this.state.containerClassNames[i]==this.props.cssClass){
                flagCssClass = false;
            }
        }
        if(flagCssClass){
            this.state.containerClassNames.push(this.props.cssClass);
        }
        return (
            &lt;div className={ this.state.containerClassNames.join(&#x27; &#x27;) } style={{&quot;max-height&quot;:this.state.maxHeight}}&gt;
                &lt;div onClick={ this.onNodeClick } &gt;
                    { treenodes }
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
}); /*Treeview END*/



/*
 * TreeviewNode component
 * @class TreeviewNode
 * 
 */
var TreeviewNode = React.createClass({
    name: &#x27;treeview-node&#x27;,
    mixins: [treeCommonMixin],
    
    /*
     * 定义属性
     * @private
     * @method getAttributes
     * @return {Array} 返回所有的初始定义的属性
     */
    getAttributes: function() {
        var attributes = [
            { name:&#x27;boxClass&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;container CSS class&#x27; },
            { name:&#x27;uid&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;unique id for node&#x27; },
            { name:&#x27;level&#x27;, type:&#x27;number&#x27;, required:false, defaultValue:1, note:&#x27;node level&#x27; },
            { name:&#x27;display&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;text display&#x27; },
            { name:&#x27;hasChildren&#x27;, type:&#x27;boolean&#x27;, required:false, defaultValue:false, note:&#x27;has children flag&#x27; },
            { name:&#x27;isExpanded&#x27;, type:&#x27;boolean&#x27;, required:false, defaultValue:false, note:&#x27;is expanded flag&#x27; },
            { name:&#x27;selectType&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&quot;none&quot;, note:&#x27;select type:none/checkbox/radio&#x27; },
            { name:&#x27;isSelected&#x27;, type:&#x27;boolean&#x27;, required:false, defaultValue:&quot;none&quot;, note:&#x27;selecte state all/partial/none&#x27; },
            { name:&#x27;item&#x27;, type:&#x27;object&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;original data item&#x27; },
        ];
        return attributes;
    },

    /*
     * React render
     * @private
     * @method render
     * @return {Object} 返回组件
     */
    render: function() {
        var items = [];
        var cells = [];
        var level = this.state.level;

        
        // add branch cells 
        for (var i = 1; i &lt; level; i++) {
            var cellData = { text:i, type:&#x27;space&#x27; };
            var cellKey = &#x27;treeview-text-cell-space-&#x27; + i;
            cells.push(
                &lt;TreeviewCell data={ cellData } key={ cellKey } /&gt;
            );
        }
        // add expand cell if there are children
        var expandCellData = {
            uid: this.state.uid + &#x27;-expand&#x27;,
            type: &#x27;expand&#x27;,
            iconClass: this.state.isExpanded ? &#x27;fa fa-caret-down&#x27; : &#x27;fa fa-caret-right&#x27;
        };
        if (!this.state.hasChildren) {
            expandCellData.iconClass = &#x27;fa&#x27;;
        }
        cells.push(&lt;TreeviewCell data={ expandCellData } key=&#x27;treeview-expand-cell&#x27; /&gt;);
        
        // add select cell
        if (this.state.selectType == &quot;checkbox&quot; || this.state.selectType==&quot;radio&quot;) {
            // checkbox select type
            var iconClass = &#x27;&#x27;;
            switch(this.state.isSelected) {
            case &quot;all&quot;:
                iconClass = &#x27;fa fa-check-square-o&#x27;;
                break;
            case &quot;part&quot;:
                iconClass = &#x27;fa fa-square&#x27;;
                break;
            case &quot;none&quot;:
                iconClass = &#x27;fa fa-square-o&#x27;;
                break;
            }
            var selectCellData = {
                uid: this.state.uid + &#x27;-select&#x27;,
                type: &#x27;select&#x27;,
                iconClass: iconClass
            };
            var selectCellKey = &#x27;treeview-select-cell&#x27;;
            cells.push(&lt;TreeviewCell data={ selectCellData } key={ selectCellKey } /&gt;);
        }
        
        // only add icon cell when iconClass is present
        if (this.state.item.iconClass) {
            var iconCellData = {
                uid: this.state.uid + &#x27;-icon&#x27;,
                type: &#x27;icon&#x27;,
                iconClass: this.state.item.iconClass
            };
            cells.push(&lt;TreeviewCell data={ iconCellData } key=&#x27;treeview-icon-cell&#x27; /&gt;);
        }
        
        // add textbox
        var textboxData = {
            uid: this.state.uid + &#x27;-textbox&#x27;,
            type: &#x27;text&#x27;,
            text: this.state.display,
        };
        cells.push(&lt;TreeviewTextBox data={ textboxData } key=&#x27;treeview-textbox&#x27; /&gt;);
        return (
            &lt;div className={ this.state.containerClassNames.join(&#x27; &#x27;) }
                data-id={ this.state.uid } 
                &gt;
                { cells }
            &lt;/div&gt;
        );
    }
});



/*
 * TreeviewCell component
 * @class TreeviewCell
 */
var TreeviewCell = React.createClass({
    name: &#x27;treeview-cell&#x27;,
    mixins: [treeCommonMixin],
    
    /*
     * 定义属性
     * @private
     * @method getAttributes
     * @return {Array} 返回所有的初始定义的属性
     */
    getAttributes: function() {
        var attributes = [
            { name:&#x27;boxClass&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;container CSS class&#x27; },
            { name:&#x27;iconClass&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;icon CSS class&#x27; },
            { name:&#x27;uid&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;unique id for cell&#x27; },
            { name:&#x27;type&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;treeview type&#x27; }
        ];
        return attributes;
    },
    /*
     * React render
     * @private
     * @method render
     * @return {Object} 返回组件
     */
    render: function() {
        // set iconClass
        var displayText = &#x27;&#x27;;
        var iconClass = this.state.iconClass || &#x27;&#x27;;
        var iconContainerClass = &#x27;treeview-cell-&#x27; + this.state.type + &#x27;-container&#x27;;
        switch (this.state.type) {
            case &#x27;text&#x27;:
                displayText = this.state.text;
                break;
            case &#x27;expand&#x27;:
                iconClass = iconClass || &#x27;fa fa-plus-square-o&#x27;;
                break;
            case &#x27;select&#x27;:
                iconClass = iconClass || &#x27;fa fa-check-square-o&#x27;;
                break;
            case &#x27;icon&#x27;:
                iconClass = iconClass || &#x27;&#x27;;
                break;
        }
        return (
            &lt;div className={ this.state.containerClassNames.join(&#x27; &#x27;) } &gt;
                &lt;div className={ iconContainerClass }&gt;
                    &lt;i className={ iconClass } data-uid={ this.state.uid } &gt;{ displayText }&lt;/i&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
});


/*
 * TreeviewTextBox component
 * @class TreeviewTextBox
 */
var TreeviewTextBox = React.createClass({
    name: &#x27;treeview-textbox&#x27;,
    mixins: [treeCommonMixin],
    
    /*
     * 定义属性
     * @private
     * @method getAttributes
     * @return {Array} 返回所有的初始定义的属性
     */
    getAttributes: function() {
        var attributes = [
            { name:&#x27;boxClass&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;container CSS class&#x27; },
            { name:&#x27;uid&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;unique id for cell&#x27; },
            { name:&#x27;text&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;display text&#x27; },
            { name:&#x27;type&#x27;, type:&#x27;string&#x27;, required:false, defaultValue:&#x27;&#x27;, note:&#x27;treeview type&#x27; },
        ];
        return attributes;
    },

    /*
     * React render
     * @private
     * @method render
     * @return {Object} 返回组件
     */
    render: function() {
        // set content
        var displayText = this.state.text;
        return (
            &lt;div className={ this.state.containerClassNames.join(&#x27; &#x27;) } &gt;
                &lt;div className=&quot;treeview-textbox-content&quot;
                    dangerouslySetInnerHTML={{ __html: displayText }}
                /&gt;
            &lt;/div&gt;
        );
    }
});


module.exports=Treeview;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
